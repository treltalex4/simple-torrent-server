# Проектная работа "Простой торрент-сервер"

## Описание
Необходимо реализовать систему, моделирующую работу простого торрент-сервера. Система должна состоять из HTTP-сервера, который выполняет роль диспетчера и трекера, и набора независимых пир-процессов, взаимодействующих с сервером через IPC.

Пиры хранят части файлов и обмениваются ими с сервером. Сервер принимает файлы от клиентов, делит их на части, распределяет части между пирами, предоставляет информацию о состоянии раздач, а также собирает части обратно для выдачи файлов клиентам.

Клиент может:
- Просматривать список доступных файлов.
- Скачивать файлы, получая их частями от пиров.
- Загружать файлы на сервер, которые затем распределяются между пирами.
- При необходимости регистрироваться как новый пир для хранения частей файлов.

Проект моделирует основные идеи P2P-систем: хранение частей, распределённость, регистрацию узлов, координацию через трекер.

---

## Требования

### 1. Архитектура системы
- HTTP-сервер, способный обрабатывать HTTP-запросы через TCP/UDP сокеты.
- Компоненты сервера:
  - **Dispatcher** — маршрутизация HTTP-запросов к соответствующим обработчикам.
  - **InfoHandler** — просмотр информации о файлах и пирах.
  - **DownloaderHandler** — получение частей через IPC и сборка файла для скачивания.
  - **UploaderHandler** — приём загружаемых файлов, их разбиение и распределение между пирами.
- Поддержка асинхронной или неблокирующей обработки HTTP-запросов (select/poll/epoll или пул потоков).
- Наличие набора независимых пир-процессов, запускаемых вручную.

### 2. Основная функциональность сервера

#### 2.1 Просмотр
- `GET /files` — список доступных файлов и их состояние.
- `GET /file?id=ID` — подробная информация о файле.
- `GET /file?name=NAME` — поиск файла по имени.
- `GET /peers` — список зарегистрированных пиров.
- `POST /register_peer` — регистрация нового пира (с указанием peer-id и ipc-path).

#### 2.2 Скачивание
- `GET /download?file=ID` или `GET /download?name=NAME`
  Сервер:
  - определяет набор необходимых частей,
  - для каждой части выбирает случайного пира (или сида), у которого она есть, и запрашивает её через IPC (`GET_PART`),
  - собирает файл из всех частей и отправляет клиенту,
  - если часть недоступна ни у одного пира, сервер возвращает ошибку 503.

#### 2.3 Загрузка
- `POST /upload`  
  Сервер:
  - принимает бинарный файл и его метаданные (имя, размер),
  - сохраняет его временно,
  - назначает уникальный ID,
  - делит на части (размер — из конфигурации),
  - распределяет части по пирами через IPC (`STORE_PART`),
  - обновляет метаданные.

### 3. Пиры
- Запускаются вручную как отдельные процессы.
- Регистрируются на сервере по HTTP.
  - либо через браузер (POST /register_peer),
  - либо через UDP-дейтаграмму, отправленную на сервер.
- Хранят части файлов в локальных директориях.
- Поддерживают IPC-команды:
  - `STORE_PART file=ID part=N [данные]`
  - `GET_PART file=ID part=N`
  - `LIST_PARTS file=ID`
- Работают в асинхронном/неблокирующем режиме.

### 4. Метаданные
Сервер обязан поддерживать потокобезопасную структуру, содержащую:
- список файлов (id, имя, размер, число частей),
- распределение частей между пирами,
- список активных пиров,
- сведения о доступности частей.

### 5. Инициализация
- Сервер должен обработать файловую директорию `server_init_files/`.
- Все файлы из неё автоматически:
  - читаются,
  - делятся на части,
  - распределяются по доступным пирам,
  - регистрируются в metadata.
- При отсутствии зарегистрированных пиров, части временно хранятся в директории сервера (`temp/`).

---

## Дополнительные требования

### 1. Асинхронность
- Неблокирующие операции при обработке HTTP-запросов.
- DownloaderHandler должен обращаться к нескольким пирам параллельно.
- Пир должен отвечать на IPC-команды без полной блокировки.

### 2. Конфигурационные файлы
Использование JSON/YAML для:
- порта HTTP-сервера,
- путей (`temp/`, `metadata/`, `init_files/`),
- списка пиров и их IPC-путей,
- размера части (`piece_size`),
- настроек логирования,
- параметров асинхронности (например, число потоков).

### 3. Логирование
- Логи HTTP-запросов,
- Логи взаимодействия с пирам (IPC),
- Логи разбиения, сборки и ошибок.
- Вывод в stdout или в файл — определяется конфигом.

### 4. Страницы ошибок
- Поддержка стандартных HTML-страниц ошибок:
  - 400 Bad Request
  - 404 Not Found
  - 500 Internal Server Error  
  - 501 Not Implemented
  - 503 Service Unavailable

### 5. Статический интерфейс
HTML-страницы:
- список файлов,
- информация о файле,
- загрузка файла,
- кнопка скачивания.

### 6. Превращение клиента в пира
- Клиент после скачивания файла может вручную запустить собственный пир-процесс.
- Пир, владеющий всеми частями файла, считается сидом.
- После регистрации сервер сам опрашивает пир через IPC (LIST_PARTS), чтобы получить список имеющихся частей.

---

## Технологии
- Язык С++ (современные стандарты C++20 или выше)
- Работа с POSIX-сокетами для реализации HTTP-сервера
- Средства IPC: Unix Domain Sockets / именованные каналы / очереди сообщений
- Многопоточность: `<thread>` или POSIX Threads
- Асинхронный ввод-вывод: `std::async` или `select`/`poll`/`epoll`
- Работа с файловой системой: `std::filesystem` или POSIX API
- Конфигурационные файлы: json/yaml
- Сборка: CMake или Makefile
- Контроль версий: Git
